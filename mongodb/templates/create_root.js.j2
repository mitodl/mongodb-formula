{% from "mongodb/map.jinja" import mongodb with context %}

// Add super user
conn = new Mongo("localhost:{{ mongodb.port }}");
db = conn.getDB("admin");

if(!db.auth('{{ MONGO_ADMIN_USER|trim }}', '{{ MONGO_ADMIN_PASSWORD|trim }}')) {
    db.createUser(
        {
            "user": "{{ MONGO_ADMIN_USER|trim }}",
            "pwd": "{{ MONGO_ADMIN_PASSWORD|trim }}",
            "roles": [{role: "root", database: "admin"}]
        }
    );
} else {
    db.updateUser(
        "{{ MONGO_ADMIN_USER|trim }}",
        {
            "pwd": "{{ MONGO_ADMIN_PASSWORD|trim }}",
            "roles": [{role: "root", database: "admin"}]
        }
    );
}
